{% extends "base.html" %}
{% load static %}
{% load socialaccount %}

{% block title %}Register | Room Finder{% endblock %}

{% block content %}
<div class="min-h-screen flex items-center justify-center relative px-4">
    <div class="fixed inset-0 bg-cover bg-center"
         style="background-image:url('https://images.unsplash.com/photo-1505691938895-1758d7feb511');"></div>
    <div class="fixed inset-0 bg-black/50 backdrop-blur-sm"></div>

    <div class="relative z-10 w-full max-w-lg bg-white rounded-2xl shadow-2xl p-10">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-extrabold text-gray-900">Room Siftay</h1>
            <p class="text-gray-600 mt-2">Find rooms or list your property easily</p>
        </div>
        {% if form.errors %}
    <div class="mb-4 p-4 rounded-xl bg-red-50 border border-red-200">
        <ul class="text-sm text-red-700 space-y-1">
            {% for field, errors in form.errors.items %}
                {% for error in errors %}
                    <li>
                        <strong>{{ field|capfirst }}:</strong> {{ error }}
                    </li>
                {% endfor %}
            {% endfor %}
        </ul>
    </div>
{% endif %}




        <!-- Register Form -->
         <!-- <form method="POST" action="{% url 'account_signup' %}" class="space-y-5"> -->
        <form method="POST" action="{% url 'register' %}" class="space-y-5">
            {% csrf_token %}

            <input type="hidden" name="username" placeholder="Username" required
                   class="w-full px-4 py-3 rounded-xl border">

            <input type="email" name="email" placeholder="Email address" required
                   class="w-full px-4 py-3 rounded-xl border">

            <input type="password" name="password1" placeholder="Password" required
                   class="w-full px-4 py-3 rounded-xl border">

            <input type="password" name="password2" placeholder="Confirm password" required
                   class="w-full px-4 py-3 rounded-xl border">

            <!-- Role Selection -->
            <div>
                <p class="text-sm font-semibold mb-3 text-gray-700">Choose your role</p>

                <div class="grid grid-cols-2 gap-4">
                    <!-- USER -->
                    <label class="cursor-pointer">
                        <input type="radio" name="role" value="user" class="peer hidden" checked>
                        <div class="p-4 rounded-xl border-2 peer-checked:border-indigo-600 peer-checked:bg-indigo-50">
                            <h3 class="font-bold text-gray-800">User</h3>
                            <p class="text-xs text-gray-600 mt-1">
                                Search rooms, contact owners, and book stays
                            </p>
                        </div>
                    </label>

                    <!-- OWNER -->
                    <label class="cursor-pointer">
                        <input type="radio" name="role" value="owner" class="peer hidden">
                        <div class="p-4 rounded-xl border-2 peer-checked:border-green-600 peer-checked:bg-green-50">
                            <h3 class="font-bold text-gray-800">Owner</h3>
                            <p class="text-xs text-gray-600 mt-1">
                                Post rooms, manage listings & tenants
                            </p>
                        </div>
                    </label>
                </div>

                <!-- Admin notice -->
                <p class="text-xs text-gray-400 mt-3 italic">
                    Admin access is restricted and not publicly available.
                </p>
            </div>

            <button class="w-full py-3 rounded-xl bg-indigo-600 text-white font-bold">
                Create Account
            </button>
        </form>

        <!-- Divider -->
        <div class="flex items-center gap-3 my-7">
            <hr class="flex-grow">
            <span class="text-xs text-gray-400">OR CONTINUE WITH</span>
            <hr class="flex-grow">
        </div>

        <!-- Social Buttons -->
        <div class="space-y-3">
            <a href="{% provider_login_url 'google' %}"
               onclick="openSocialModal(event, this)"
               class="flex items-center justify-center gap-3 py-3 border rounded-xl hover:bg-gray-50">
                <img src="https://www.svgrepo.com/show/475656/google-color.svg" class="w-5">
                <span class="font-semibold">Google</span>
            </a>

            <a href="{% provider_login_url 'github' %}"
               onclick="openSocialModal(event, this)"
               class="flex items-center justify-center gap-3 py-3 bg-gray-900 text-white rounded-xl hover:bg-black">
                <img src="https://www.svgrepo.com/show/512317/github-142.svg" class="w-5 invert">
                <span class="font-semibold">GitHub</span>
            </a>
        </div>
    </div>
</div>

<!-- SOCIAL MODAL -->
<div id="socialModal" class="fixed inset-0 hidden items-center justify-center bg-black/60 z-50">
    <div class="bg-white rounded-xl p-6 w-full max-w-sm text-center">
        <h2 class="text-xl font-bold mb-2">Continue with Social Login</h2>
        <p class="text-gray-600 mb-4">
            You are signing up as
            <span id="roleLabel" class="font-semibold"></span>
        </p>

        <div class="flex gap-3">
            <button onclick="closeModal()"
                    class="flex-1 py-2 border rounded-lg">
                Cancel
            </button>
            <button id="continueBtn"
                    class="flex-1 py-2 bg-indigo-600 text-white rounded-lg">
                Continue
            </button>
        </div>
    </div>
</div>

<script>
let socialUrl = "";

function openSocialModal(event, el) {
    event.preventDefault();

    const role = document.querySelector('input[name="role"]:checked').value;
    document.cookie = "social_role=" + role + "; path=/; max-age=3600";

    document.getElementById("roleLabel").innerText =
        role === "owner" ? "Owner (Post Rooms)" : "User (Find Rooms)";

    socialUrl = el.href;

    document.getElementById("socialModal").classList.remove("hidden");
    document.getElementById("socialModal").classList.add("flex");
}

function closeModal() {
    document.getElementById("socialModal").classList.add("hidden");
}

document.getElementById("continueBtn").onclick = () => {
    window.location.href = socialUrl;
};
</script>
{% endblock %}
