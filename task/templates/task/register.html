<!-- {% extends "base.html" %} -->
{% load static %}
{% load socialaccount %}

{% block title %}Register | RoomSiftay{% endblock %}

<!-- {% block content %} -->
<script src="https://cdn.tailwindcss.com"></script>

<div class="min-h-screen relative flex items-center justify-center px-4">

    <!-- Background -->
    <div class="fixed inset-0 bg-cover bg-center"
         style="background-image:url('https://images.unsplash.com/photo-1505691938895-1758d7feb511');"></div>
    <div class="fixed inset-0 bg-black/30"></div>

    <!-- Card -->
    <div class="relative z-10 w-full max-w-md bg-gray-200/90 backdrop-blur-lg
                rounded-2xl shadow-xl px-8 py-10
                animate-fade-in-up">

        <!-- Logo -->
        <div class="text-center mb-6">
            <div class="flex justify-center mb-2">
                <div class="w-12 h-12 bg-indigo-600 text-white
                            flex items-center justify-center rounded-xl text-xl font-bold">
                    üè†
                </div>
            </div>
            <h1 class="text-2xl font-bold text-gray-900">RoomSiftay</h1>
            <p class="text-sm text-indigo-600">Create your account</p>
        </div>

        <!-- Errors -->
        {% if form.errors %}
        <div class="mb-4 p-3 rounded-lg bg-red-100 text-red-700 text-sm">
            {% for field, errors in form.errors.items %}
                {% for error in errors %}
                    <p>{{ error }}</p>
                {% endfor %}
            {% endfor %}
        </div>
        {% endif %}

        <!-- Form -->
        <form method="POST" action="{% url 'register' %}" class="space-y-4">
            {% csrf_token %}
            <input type="hidden" name="username">

            <input type="email" name="email" placeholder="Email address" required
                   class="w-full px-4 py-3 rounded-lg bg-blue-50
                          focus:ring-2 focus:ring-indigo-500 outline-none">

            <input type="password" name="password1" placeholder="Password" required
                   class="w-full px-4 py-3 rounded-lg bg-blue-50
                          focus:ring-2 focus:ring-indigo-500 outline-none">

            <input type="password" name="password2" placeholder="Confirm password" required
                   class="w-full px-4 py-3 rounded-lg bg-blue-50
                          focus:ring-2 focus:ring-indigo-500 outline-none">

            <!-- Roles -->
            <div>
                <p class="text-sm font-semibold mb-2">Choose your role</p>

                <div class="grid grid-cols-3 gap-2 text-sm">

                    <!-- User -->
                    <label class="cursor-pointer">
                        <input type="radio" name="role" value="buyer" checked class="peer hidden">
                        <div class="p-3 rounded-lg border bg-white
                                    peer-checked:border-indigo-600
                                    transition hover:shadow">
                            üë§ <b>User</b>
                            <p class="text-xs text-gray-500">Find & book rooms</p>
                        </div>
                    </label>

                    <!-- Owner -->
                    <label class="cursor-pointer">
                        <input type="radio" name="role" value="owner" class="peer hidden">
                        <div class="p-3 rounded-lg border bg-white
                                    peer-checked:border-indigo-600
                                    transition hover:shadow">
                            üè† <b>Owner</b>
                            <p class="text-xs text-gray-500">Post & manage rooms</p>
                        </div>
                    </label>

                    <!-- Admin (Disabled) -->
                    <div class="p-3 rounded-lg border bg-gray-100 text-gray-400 cursor-not-allowed">
                        üîí <b>Admin</b>
                        <p class="text-xs">Restricted</p>
                    </div>
                </div>

                <p class="text-xs text-gray-500 mt-2 italic">
                    Admin access is not publicly available.
                </p>
            </div>

            <!-- Button -->
            <button
                class="w-full py-3 rounded-xl bg-indigo-600
                       text-white font-semibold text-lg
                       hover:bg-indigo-700 transition
                       active:scale-95">
                Create Account
            </button>
        </form>

        <!-- Divider -->
        <div class="flex items-center gap-3 my-6">
            <hr class="flex-grow border-gray-400">
            <span class="text-xs text-gray-600">OR</span>
            <hr class="flex-grow border-gray-400">
        </div>

        <!-- Social -->
        <div class="space-y-3">
            <a href="{% provider_login_url 'google' %}"
               onclick="openSocialModal(event, this)"
               class="flex items-center justify-center gap-3 py-2
                      bg-white rounded-lg shadow hover:bg-gray-50">
                <img src="https://www.svgrepo.com/show/475656/google-color.svg" class="w-5">
                Continue with Google
            </a>

            <!-- <a href="{% provider_login_url 'github' %}"
               onclick="openSocialModal(event, this)"
               class="flex items-center justify-center gap-3 py-2
                      bg-gray-900 text-white rounded-lg hover:bg-black">
                <img src="https://www.svgrepo.com/show/512317/github-142.svg"
                     class="w-5 invert">
                Continue with GitHub
            </a> -->
        </div>

        <!-- Login -->
        <p class="text-center text-sm mt-6">
            Already signed up?
            <a href="{% url 'login' %}" class="text-indigo-600 font-semibold">
                Login
            </a>
        </p>
    </div>
</div>

<!-- SOCIAL ROLE CONFIRM MODAL -->
<div id="socialModal"
     class="fixed inset-0 hidden items-center justify-center bg-black/60 z-50">
    <div class="bg-white rounded-xl p-6 w-full max-w-sm text-center
                animate-scale-in">
        <h2 class="text-xl font-bold mb-2">Continue with Social Login</h2>
        <p class="text-gray-600 mb-4">
            You are signing up as
            <span id="roleLabel" class="font-semibold"></span>
        </p>

        <div class="flex gap-3">
            <button onclick="closeModal()"
                    class="flex-1 py-2 border rounded-lg">
                Cancel
            </button>
            <button id="continueBtn"
                    class="flex-1 py-2 bg-indigo-600 text-white rounded-lg">
                Continue
            </button>
        </div>
    </div>
</div>

<!-- Scripts -->
<script>
let socialUrl = "";

function openSocialModal(event, el) {
    event.preventDefault();
    const role = document.querySelector('input[name="role"]:checked').value;

    document.cookie = "social_role=" + role + "; path=/; max-age=3600";

    document.getElementById("roleLabel").innerText =
        role === "owner" ? "Owner" : "User";

    socialUrl = el.href;
    document.getElementById("socialModal").classList.remove("hidden");
    document.getElementById("socialModal").classList.add("flex");
}

function closeModal() {
    document.getElementById("socialModal").classList.add("hidden");
}

document.getElementById("continueBtn").onclick = () => {
    window.location.href = socialUrl;
};
</script>

<!-- Animations -->
<style>
@keyframes fadeInUp {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}
.animate-fade-in-up {
    animation: fadeInUp 0.6s ease-out;
}
@keyframes scaleIn {
    from { transform: scale(0.9); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
}
.animate-scale-in {
    animation: scaleIn 0.3s ease-out;
}
</style>
<!-- {% endblock %} -->
