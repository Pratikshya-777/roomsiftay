{% extends "base.html" %}
{% block title %}{{ listing.title }}{% endblock %}

{% block content %}

<div class="max-w-6xl mx-auto px-6 py-10 space-y-10">

    <!-- TITLE -->
    <div>
        <h1 class="text-3xl font-bold text-gray-900">
            {{ listing.title }}
        </h1>
        <p class="text-gray-500 mt-1">
            {{ listing.city }}{% if listing.area %}, {{ listing.area }}{% endif %}
        </p>
    </div>


    <!-- IMAGE GRID (ROOM PHOTOS ONLY) -->
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6">
        {% for photo in listing.photos.all %}
            {% if not photo.is_proof %}
                <img src="{{ photo.image.url }}"
                     onclick="openImageModal('{{ photo.image.url }}')"
                     class="rounded-2xl object-cover h-64 w-full border cursor-pointer hover:opacity-90 transition">
            {% endif %}
        {% empty %}
            <div class="col-span-full bg-gray-100 h-64 rounded-2xl flex items-center justify-center text-gray-400">
                No photos uploaded
            </div>
        {% endfor %}
    </div>


    <!-- MAIN CONTENT -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-10">

        <!-- LEFT SIDE -->
        <div class="lg:col-span-2 space-y-6">

            <!-- PROPERTY DETAILS -->
            <div class="bg-white p-6 rounded-2xl border shadow-sm">
                <h3 class="font-semibold text-lg mb-6">Property Details</h3>

                <div class="grid grid-cols-2 gap-4 text-gray-700 text-sm">

                    <p><strong>Room Type:</strong> {{ listing.get_room_type_display }}</p>
                    <p><strong>Total Area:</strong> {{ listing.total_area }} sq.ft</p>

                    <p><strong>Bedrooms:</strong> {{ listing.bedrooms }}</p>
                    <p><strong>Bathrooms:</strong> {{ listing.bathrooms }}</p>

                    <p><strong>Floor:</strong> {{ listing.floor_number }}</p>
                    <p><strong>Kitchen:</strong> {{ listing.get_kitchen_type_display }}</p>

                    <p><strong>Security Deposit:</strong> NPR {{ listing.security_deposit }}</p>
                    <p><strong>Balcony:</strong> {{ listing.has_balcony|yesno:"Yes,No" }}</p>

                </div>
            </div>


            <!-- AMENITIES -->
            <div class="bg-white p-6 rounded-2xl border shadow-sm">
                <h3 class="font-semibold text-lg mb-4">Amenities</h3>

                <div class="flex flex-wrap gap-3 text-sm">

                    {% if listing.is_furnished %}
                    <span class="px-3 py-1 bg-gray-100 rounded-full">ü™ë Furnished</span>
                    {% endif %}

                    {% if listing.wifi_available %}
                    <span class="px-3 py-1 bg-gray-100 rounded-full">üì∂ WiFi</span>
                    {% endif %}

                    {% if listing.parking_available %}
                    <span class="px-3 py-1 bg-gray-100 rounded-full">üöó Parking</span>
                    {% endif %}

                    {% if listing.utilities_included %}
                    <span class="px-3 py-1 bg-gray-100 rounded-full">üí° Utilities Included</span>
                    {% endif %}

                    {% if listing.ac_available %}
                    <span class="px-3 py-1 bg-gray-100 rounded-full">‚ùÑÔ∏è Air Conditioning</span>
                    {% endif %}

                    {% if listing.water_24hrs %}
                    <span class="px-3 py-1 bg-gray-100 rounded-full">üöø 24/7 Water</span>
                    {% endif %}

                    {% if listing.lift_available %}
                    <span class="px-3 py-1 bg-gray-100 rounded-full">üõó Lift</span>
                    {% endif %}

                    {% if listing.pet_allowed %}
                    <span class="px-3 py-1 bg-gray-100 rounded-full">üê∂ Pet Allowed</span>
                    {% endif %}

                </div>
            </div>

        </div>


        <!-- RIGHT SIDE PRICE CARD -->
        <div>
            <div class="bg-white p-6 rounded-2xl border shadow-sm space-y-4 sticky top-24">

                <p class="text-3xl font-bold text-slate-900">
                    NPR {{ listing.monthly_rent }}
                    <span class="text-sm font-normal text-gray-500">/ month</span>
                </p>

                <a href="{% url 'save_listing' listing.id %}"
                   class="block text-center py-3 rounded-xl border font-semibold
                   {% if is_saved %}bg-gray-100{% endif %}">
                    {% if is_saved %}
                        ‚ù§Ô∏è Saved
                    {% else %}
                        ü§ç Save Listing
                    {% endif %}
                </a>

                <a href="{% url 'start_chat' listing.id %}"
                   class="block text-center py-3 rounded-xl bg-slate-900 text-white font-semibold hover:bg-black transition">
                    Chat with Owner
                </a>

            </div>
        </div>

    </div>

</div>


<!-- IMAGE MODAL -->
<div id="imageModal"
     class="fixed inset-0 bg-black/80 hidden items-center justify-center z-50">

    <div class="relative max-w-4xl w-full px-4">
        <button onclick="closeImageModal()"
                class="absolute top-4 right-6 text-white text-3xl font-bold">
            ‚úï
        </button>

        <img id="modalImage"
             class="w-full max-h-[85vh] object-contain rounded-xl shadow-2xl">
    </div>
</div>


<script>
function openImageModal(imageUrl) {
    document.getElementById("modalImage").src = imageUrl;
    document.getElementById("imageModal").classList.remove("hidden");
    document.getElementById("imageModal").classList.add("flex");
}

function closeImageModal() {
    document.getElementById("imageModal").classList.add("hidden");
    document.getElementById("imageModal").classList.remove("flex");
}

document.getElementById("imageModal").addEventListener("click", function(e) {
    if (e.target === this) {
        closeImageModal();
    }
});
</script>

{% endblock %}
