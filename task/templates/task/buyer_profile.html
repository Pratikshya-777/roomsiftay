{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="min-h-screen bg-gray-100 py-10 px-4">

  <div class="max-w-4xl mx-auto space-y-8">

    <!-- HEADER CARD -->
    <div class="bg-white rounded-2xl shadow p-6 flex items-center justify-between">
      <div class="flex items-center gap-6">

        <!-- Avatar -->
        <label class="relative cursor-pointer">
          {% if profile.profile_photo %}
            <img src="{{ profile.profile_photo.url }}"
                 class="w-24 h-24 rounded-full object-cover border">
          {% else %}
            <img src="https://ui-avatars.com/api/?name={{ request.user.get_full_name|default:request.user.username }}&background=4f46e5&color=fff&size=256"
                 class="w-24 h-24 rounded-full border">
          {% endif %}

          <input type="file" name="profile_photo"
                 form="profileForm"
                 onchange="this.form.submit()"
                 class="hidden">
          <span class="absolute bottom-0 right-0 bg-indigo-600 text-white p-1 rounded-full text-xs">âœŽ</span>
        </label>

        <!-- Identity -->
        <div>
          <h2 class="text-2xl font-bold text-gray-800">
            {{ request.user.get_full_name|default:request.user.username }}
          </h2>
          <p class="text-gray-500">{{ request.user.email }}</p>
        </div>
      </div>

      <!-- Completion -->
      <div class="text-right">
        <p class="text-sm text-gray-500 mb-1">Profile Completion</p>
        <div class="w-40 bg-gray-200 rounded-full h-2">
          <div class="bg-indigo-600 h-2 rounded-full" style="width: '${{ completion }}%'"></div>
        </div>
        <p class="text-sm font-semibold mt-1">{{ completion }}%</p>
      </div>
    </div>

    <!-- PERSONAL INFO -->
    <div class="bg-white rounded-2xl shadow p-6">
      <h3 class="text-lg font-semibold mb-4">Personal Information</h3>

      <form id="profileForm" method="POST" enctype="multipart/form-data" class="grid grid-cols-1 md:grid-cols-2 gap-4">
        {% csrf_token %}

        <div>
          <label class="text-sm text-gray-600">Full Name</label>
          <input type="text"
                 value="{{ request.user.get_full_name }}"
                 disabled
                 class="w-full mt-1 p-2 border rounded-lg bg-gray-100">
        </div>

        <div>
          <label class="text-sm text-gray-600">Email</label>
          <input type="email"
                 value="{{ request.user.email }}"
                 disabled
                 class="w-full mt-1 p-2 border rounded-lg bg-gray-100">
        </div>

        <div>
          <label class="text-sm text-gray-600">Phone Number</label>
          {{ form.phone_number }}
        </div>

        <div class="flex items-end">
          <button type="submit"
            class="bg-indigo-600 text-white px-6 py-2 rounded-lg hover:bg-indigo-500 transition">
            Save Info
          </button>
        </div>
      </form>
    </div>

    <!-- OPTIONAL ROOM PREFERENCES -->
    <div class="bg-white rounded-2xl shadow p-6">
      <h3 class="text-lg font-semibold mb-2">Room Preferences (Optional)</h3>
      <p class="text-sm text-gray-500 mb-4">
        This helps us personalize your experience. You can skip this.
      </p>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <input type="text" placeholder="Preferred Location" class="p-2 border rounded-lg">
        <input type="number" placeholder="Budget (NPR)" class="p-2 border rounded-lg">
        <select class="p-2 border rounded-lg">
          <option>Room Type</option>
          <option>Single</option>
          <option>Shared</option>
          <option>Flat</option>
        </select>
      </div>
    </div>

<div class="bg-white rounded-2xl shadow p-6">
  <h3 class="text-lg font-semibold mb-2">Change Password</h3>
  <p class="text-sm text-gray-500 mb-4">
    Update your account password regularly to keep it secure.
  </p>

  <form method="POST" class="space-y-4">
    {% csrf_token %}
    <input type="hidden" name="change_password">

    {% for field in password_form %}
      <div>
        <label class="block text-sm font-medium text-gray-700">
          {{ field.label }}
        </label>
        {{ field }}
        {% if field.errors %}
          <p class="text-sm text-red-600">{{ field.errors|striptags }}</p>
        {% endif %}
      </div>
    {% endfor %}

    <button type="submit"
      class="bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-500 transition">
      Update Password
    </button>
  </form>
</div>

  </div>
</div>
{% endblock %}
