{% extends "base.html" %}
{% block title %}Messages{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto py-8 px-4">

  <!-- Header -->
  <div class="mb-6">
    <h1 class="text-2xl font-bold text-gray-900">ðŸ’¬ Messages</h1>
    <p class="text-sm text-gray-500">
      Conversations related to your listings
    </p>
  </div>

  <!-- Conversation List -->
  <div class="bg-white rounded-2xl shadow divide-y">

    {% for convo in conversations %}
    <a href="{% url 'chat_room' convo.id %}"
       class="flex justify-between items-center p-4 hover:bg-gray-50 transition">

      <!-- Left -->
      <div class="min-w-0">
        <p class="font-medium text-gray-800 truncate">
          {{ convo.listing.title }}
        </p>

        <p class="text-sm text-gray-500">
          {% if request.user == convo.owner %}
            Buyer: {{ convo.buyer.username }}
          {% else %}
            Owner: {{ convo.owner.username }}
          {% endif %}
        </p>

        {% with convo.messages.last as last_msg %}
          {% if last_msg %}
            <p class="text-xs text-gray-400 truncate mt-1">
              {{ last_msg.text }}
            </p>
          {% else %}
            <p class="text-xs text-gray-400 italic mt-1">
              No messages yet
            </p>
          {% endif %}
        {% endwith %}
      </div>

      <!-- Right -->
      <div class="flex flex-col items-end text-xs text-gray-400">
        <span>
          {{ convo.created_at|date:"M d" }}
        </span>
        <span class="text-lg">
          â†’
        </span>
      </div>

    </a>
    {% empty %}
    <div class="p-10 text-center text-gray-500">
      <p class="font-medium">No conversations yet</p>
      <p class="text-sm mt-1">
        Start a chat from a listing to see it here.
      </p>
    </div>
    {% endfor %}

  </div>
</div>
{% endblock %}
